#!/bin/sh
# Register/unregister thailatex
# Written by Theppitak Karoonboonyanan <thep@linux.thai.net>
# License: GPL

prefix=@prefix@

DVIPSFONTS_MAP=${prefix}/share/texmf/dvips/base/psfonts.map
DVIPSCONFIG=${prefix}/share/texmf/dvips/config/config.ps
PDFTEXCONFIG=${prefix}/share/texmf/pdftex/config/pdftex.cfg

# remove remaing Thai font entries in dvips base psfonts.map if any
# (deprecated implementation)
if test -f $DVIPSFONTS_MAP; then
  sed -e '/^dbtt/d;/^rnorasi/d' $DVIPSFONTS_MAP > /tmp/tmp.$$
  mv /tmp/tmp.$$ $DVIPSFONTS_MAP
fi

case "$1" in
  install)
    # For tetex > 1.0.7 only
    # @UPDMAP@ --enable Map thai.map

    # For tetex <= 1.0.7

    # add thai.map as additional map to dvips local config
    mkdir -p `dirname $DVIPSCONFIG`
    if test -f $DVIPSCONFIG; then
      sed -e '/thailatex/d;/thai.map/d' $DVIPSCONFIG > /tmp/tmp.$$
      mv -f /tmp/tmp.$$ $DVIPSCONFIG
    fi
    echo "% thailatex" >> $DVIPSCONFIG
    echo "p +thai.map" >> $DVIPSCONFIG

    # add thai.map as additional map to pdftex local config
    mkdir -p `dirname $PDFTEXCONFIG`
    if test -f $PDFTEXCONFIG; then
      sed -e '/thailatex/d;/thai.map/d' $PDFTEXCONFIG > /tmp/tmp.$$
      mv -f /tmp/tmp.$$ $PDFTEXCONFIG
    fi
    echo "% thailatex"   >> $PDFTEXCONFIG
    echo "map +thai.map" >> $PDFTEXCONFIG

    # -- end For tetex <= 1.0.7
    
    @TEXHASH@

    # add Emacs macro for activating Thai LaTeX filter
    EMACSLISPDIR=@emacsdir@/site-lisp
    if test -f $EMACSLISPDIR/site-start.el; then
      sed -e '/thai-latex-setup/d' $EMACSLISPDIR/site-start.el > /tmp/tmp.$$
      mv /tmp/tmp.$$ $EMACSLISPDIR/site-start.el
    fi
    if test -f $EMACSLISPDIR/thai-latex-setup.el; then
      echo '(load-library "thai-latex-setup")' >> $EMACSLISPDIR/site-start.el
    fi
  ;;

  uninstall)
    # For tetex > 1.0.7 only
    # @UPDMAP@ --disable thai.map

    # For tetex <= 1.0.7

    # remove thai.map from dvips local config
    if test -f $DVIPSCONFIG; then
      sed -e '/thailatex/d;/thai.map/d' $DVIPSCONFIG > /tmp/tmp.$$
      mv -f /tmp/tmp.$$ $DVIPSCONFIG
    fi

    # remove thai.map from pdftex local config
    if test -f $PDFTEXCONFIG; then
      sed -e '/thailatex/d;/thai.map/d' $PDFTEXCONFIG > /tmp/tmp.$$
      mv -f /tmp/tmp.$$ $PDFTEXCONFIG
    fi

    # -- end For tetex <= 1.0.7

    @TEXHASH@

    # remove Emacs macro for activating Thai LaTeX filter
    EMACSLISPDIR=@emacsdir@/site-lisp
    if test -f $EMACSLISPDIR/site-start.el; then
      sed -e '/thai-latex-setup/d' $EMACSLISPDIR/site-start.el > /tmp/tmp.$$
      mv /tmp/tmp.$$ $EMACSLISPDIR/site-start.el
    fi
  ;;

  *)
    exit 0
  ;;
esac


